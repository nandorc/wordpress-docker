#!/bin/bash

# Create .bashrc and .bash_profile if needed on Git Bash
if [ -n "${WINDIR}" ]; then
  if [ ! -f ~/.bash_profile ]; then
    echo "# generated by Git for Windows" >>~/.bash_profile
    echo "test -f ~/.profile && . ~/.profile" >>~/.bash_profile
    echo "test -f ~/.bashrc && . ~/.bashrc" >>~/.bash_profile
  fi
  if [ ! -f ~/.bashrc ]; then
    echo "[ -f ~/.bash_aliases ] && source ~/.bash_aliases" >>~/.bashrc
  fi
fi

alias_command='last_wp_path=""; [ -f ./wpenv ] && last_wp_path="./wpenv"; [ -f ./bin/wpenv ] && last_wp_path="./bin/wpenv"; [ -z "${last_wp_path}" ] && echo "ERR~ wpenv not found" || $last_wp_path'
[ ! -f ~/.bash_aliases ] && touch ~/.bash_aliases
[ -n "$(cat ~/.bash_aliases | grep "^alias wpenv=")" ] && sed -i -e "/^alias wpenv=/d" ~/.bash_aliases
echo "alias wpenv='${alias_command}'" >>~/.bash_aliases

if [ $? -eq 0 ]; then
  [ -n "${WINDIR}" ] && echo -e "WRN~ Must close and reopen window to apply changes or type 'source ~/.bash_aliases'" || newgrp
fi
